import{d as je,L as Ne,l,M as Ae,k as X,b as we,m as se,N as Fe,u as Pe}from"./vendor.36c2bc47.js";const Qe={},Oe=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),ke=()=>Qe;je({name:"RequestConfig",props:{config:{type:Object,required:!0}},setup(e,{slots:n}){const{config:t}=e;return Ne(Oe,t),()=>{var r;return(r=n.default)===null||r===void 0?void 0:r.call(n)}}});const We=Object.prototype.toString,be=e=>We.call(e),De=e=>be(e)==="[object String]",qe=e=>be(e)==="[object Object]",me=e=>e!==null&&typeof e=="object",Ke=e=>me(e)&&ue(e.then)&&ue(e.catch),ue=e=>e instanceof Function,ie=e=>e==null,ge=typeof window>"u",ve=()=>{var e,n;return!ge&&((e=window)===null||e===void 0||(n=e.document)===null||n===void 0?void 0:n.visibilityState)==="visible"},ye=()=>{var e,n,t;return(e=!ge&&((n=window)===null||n===void 0||(t=n.navigator)===null||t===void 0?void 0:t.onLine))!==null&&e!==void 0?e:!0},xe=e=>{const n={};return Object.keys(e).forEach(t=>{n[t]=Pe(e[t])}),n},Z=Promise.resolve(null),pe=async(...e)=>{const n=await fetch(...e);if(n.ok)return n.json();throw new Error(n.statusText)};function Ue(e,n){const t=Object.assign({},e);for(const r of n)delete t[r];return t}const Be=(e,n=!1)=>{const t=`Warning: [vue-request] ${e}`;if(n)return new Error(t);console.error(t)},Me=(e,n)=>{let t=!1;return(...r)=>{t||(t=!0,e(...r),setTimeout(()=>{t=!1},n))}};var ce;const Re=new Set,Ie=new Set,_e=new Set,re=(e,n)=>{let t;switch(e){case"FOCUS_LISTENER":t=Re;break;case"RECONNECT_LISTENER":t=_e;break;case"VISIBLE_LISTENER":t=Ie;break}if(!t.has(n))return t.add(n),()=>{t.delete(n)}},de=e=>{e.forEach(n=>{n()})};!ge&&(ce=window)!==null&&ce!==void 0&&ce.addEventListener&&(window.addEventListener("visibilitychange",()=>{ve()&&de(Ie)},!1),window.addEventListener("focus",()=>de(Re),!1),window.addEventListener("online",()=>de(_e),!1));function Le(e,n,t){let r,s,E,f,d,v,T=0,Q=!1,C=!1,N=!0;const U=!n&&n!==0&&typeof window.requestAnimationFrame=="function";if(typeof e!="function")throw new TypeError("Expected a function");n=+n||0,me(t)&&(Q=!!t.leading,C="maxWait"in t,E=C?Math.max(+t.maxWait||0,n):E,N="trailing"in t?!!t.trailing:N);function R(a){const u=r,m=s;return r=s=void 0,T=a,f=e.apply(m,u),f}function I(a,u){return U?(window.cancelAnimationFrame(d),window.requestAnimationFrame(a)):setTimeout(a,u)}function k(a){if(U)return window.cancelAnimationFrame(a);clearTimeout(a)}function p(a){return T=a,d=I(_,n),Q?R(a):f}function W(a){const u=a-v,m=a-T,y=n-u;return C?Math.min(y,E-m):y}function B(a){const u=a-v,m=a-T;return v===void 0||u>=n||u<0||C&&m>=E}function _(){const a=Date.now();if(B(a))return G(a);d=I(_,W(a))}function G(a){return d=void 0,N&&r?R(a):(r=s=void 0,f)}function S(){d!==void 0&&k(d),T=0,r=v=s=d=void 0}function D(){return d===void 0?f:G(Date.now())}function q(){return d!==void 0}function w(...a){const u=Date.now(),m=B(u);if(r=a,s=this,v=u,m){if(d===void 0)return p(v);if(C)return d=I(_,n),R(v)}return d===void 0&&(d=I(_,n)),f}return w.cancel=S,w.flush=D,w.pending=q,w}function Ve(e,n,t){let r=!0,s=!0;if(typeof e!="function")throw new TypeError("Expected a function");return me(t)&&(r="leading"in t?!!t.leading:r,s="trailing"in t?!!t.trailing:s),Le(e,n,{leading:r,trailing:s,maxWait:n})}const He=(e,n)=>t=>{Object.keys(t).forEach(r=>{e[r].value=t[r]}),n.forEach(r=>r(e))},oe=(e,n,t)=>{var r,s,E;const{initialAutoRunFlag:f,initialData:d,loadingDelay:v,pollingInterval:T,debounceInterval:Q,debounceOptions:C,throttleInterval:N,throttleOptions:U,pollingWhenHidden:R,pollingWhenOffline:I,errorRetryCount:k,errorRetryInterval:p,stopPollingWhenHiddenOrOffline:W,refreshOnWindowFocus:B,refocusTimespan:_,updateCache:G,formatResult:S,onSuccess:D,onError:q,onBefore:w,onAfter:a}=n,u=l(0),m=l((r=t?.loading)!==null&&r!==void 0?r:!1),y=l((s=t?.data)!==null&&s!==void 0?s:d),A=l(t?.error),K=l((E=t?.params)!==null&&E!==void 0?E:[]),j=He({loading:m,data:y,error:A,params:K},[i=>G(i)]),M=()=>{u.value=0},F=l(0),V=l(),$=l(),H=l(),ee=()=>{V.value&&V.value(),H.value&&H.value(),$.value&&$.value()},z=()=>{let i;return v&&(i=setTimeout(j,v,{loading:!0})),()=>i&&clearTimeout(i)},ne=i=>{if(A.value&&k!==0)return;let g;if(!ie(T)&&T>=0)if((R||ve())&&(I||ye()))g=setTimeout(i,T);else{W.value=!0;return}return()=>g&&clearTimeout(g)},o=we(()=>{if(p)return p;const i=1e3,g=1,b=9,x=Math.floor(Math.random()*2**Math.min(u.value,b)+g);return i*x}),h=i=>{let g;const b=k===-1,x=u.value<k;return A.value&&(b||x)&&(b||(u.value+=1),g=setTimeout(i,o.value)),()=>g&&clearTimeout(g)},c=(...i)=>{j({loading:!v,params:i}),H.value=z(),F.value+=1;const g=F.value;return w?.(i),e(...i).then(b=>{if(g===F.value){const x=S?S(b):b;return j({data:x,loading:!1,error:void 0}),D&&D(x,i),M(),x}return Z}).catch(b=>(g===F.value&&(j({data:void 0,loading:!1,error:b}),q&&q(b,i),console.error(b)),Z)).finally(()=>{g===F.value&&(H.value(),$.value=h(()=>c(...i)),V.value=ne(()=>c(...i)),a?.(i))})},L=!ie(Q)&&Le(c,Q,C),O=!ie(N)&&Ve(c,N,U),P=(...i)=>(ee(),!f.value&&L?(L(...i),Z):O?(O(...i),Z):(M(),c(...i))),J=()=>{F.value+=1,j({loading:!1}),L&&L.cancel(),O&&O.cancel(),ee()},le=()=>P(...K.value),Se=i=>{const g=ue(i)?i(y.value):i;j({data:g})},he=[],te=i=>{i&&he.push(i)},Ee=()=>{W.value&&(R||ve())&&(I||ye())&&(le(),W.value=!1)};R||te(re("VISIBLE_LISTENER",Ee)),I||te(re("RECONNECT_LISTENER",Ee));const Te=Me(le,_);return B&&(te(re("VISIBLE_LISTENER",Te)),te(re("FOCUS_LISTENER",Te))),{loading:m,data:y,error:A,params:K,run:P,cancel:J,refresh:le,mutate:Se,unmount:()=>{he.forEach(i=>i())}}},ae=new Map,fe=e=>{if(ie(e))return;const n=ae.get(e);if(!!n)return{data:n.data,cacheTime:n.cacheTime}},Ye=(e,n,t)=>{const r=ae.get(e);r!=null&&r.timer&&clearTimeout(r.timer);const s=setTimeout(()=>ae.delete(e),t);ae.set(e,{data:n,timer:s,cacheTime:new Date().getTime()})},Y="__QUERY_DEFAULT_KEY__";function Ge(e,n){const t=Ae(Oe,{}),{cacheKey:r,defaultParams:s=[],manual:E=!1,ready:f=l(!0),refreshDeps:d=[],loadingDelay:v=0,pollingWhenHidden:T=!1,pollingWhenOffline:Q=!1,refreshOnWindowFocus:C=!1,refocusTimespan:N=5e3,cacheTime:U=6e5,staleTime:R=0,errorRetryCount:I=0,errorRetryInterval:k=0,queryKey:p,...W}={...ke(),...t,...n},B=l(!1),_=l(!1),S={initialAutoRunFlag:_,loadingDelay:v,pollingWhenHidden:T,pollingWhenOffline:Q,stopPollingWhenHiddenOrOffline:B,cacheKey:r,errorRetryCount:I,errorRetryInterval:k,refreshOnWindowFocus:C,refocusTimespan:N,updateCache:o=>{var h,c;if(!r)return;const L=(h=fe(r))===null||h===void 0?void 0:h.data,O=L?.queries,P=xe(o),J=(c=p?.(...o.params.value))!==null&&c!==void 0?c:Y;Ye(r,{queries:{...O,[J]:{...O?.[J],...P}},latestQueriesKey:J},U)},...Ue(W,["pagination","listKey"])},D=l(!1),q=l(),w=l(),a=l(),u=X({[Y]:X(oe(e,S))}),m=l(Y),y=we(()=>{var o;return(o=u[m.value])!==null&&o!==void 0?o:{}});if(se(y,o=>{D.value=o.loading,q.value=o.data,w.value=o.error,a.value=o.params},{immediate:!0,deep:!0}),r){var A;const o=fe(r);o!=null&&(A=o.data)!==null&&A!==void 0&&A.queries&&(Object.keys(o.data.queries).forEach(h=>{const c=o.data.queries[h];u[h]=X(oe(e,S,{loading:c.loading,params:c.params,data:c.data,error:c.error}))}),o.data.latestQueriesKey&&(m.value=o.data.latestQueriesKey))}const K=l(),j=l(!1),M=(...o)=>{var h;if(!f.value&&!j.value)return K.value=o,Z;const c=(h=p?.(...o))!==null&&h!==void 0?h:Y;return u[c]||(u[c]=X(oe(e,S))),m.value=c,y.value.run(...o)},F=()=>{V(),m.value=Y,u[Y]=X(oe(e,S))},V=()=>{Object.keys(u).forEach(o=>{u[o].cancel(),u[o].unmount(),delete u[o]})},$=()=>y.value.cancel(),H=()=>y.value.refresh(),ee=o=>y.value.mutate(o);if(!E){var z;_.value=!0;const o=fe(r),h=(z=o?.data.queries)!==null&&z!==void 0?z:{},c=o&&(R===-1||o.cacheTime+R>new Date().getTime()),L=Object.keys(h).length>0;c||(L?Object.keys(u).forEach(O=>{var P;(P=u[O])===null||P===void 0||P.refresh()}):M(...s)),_.value=!1}const ne=l();return ne.value=se(f,o=>{j.value=!0,o&&K.value&&(M(...K.value),ne.value())},{flush:"sync"}),d.length&&se(d,()=>{!E&&y.value.refresh()}),Fe(()=>{V()}),{loading:D,data:q,error:w,params:a,cancel:$,refresh:H,mutate:ee,run:M,reset:F,queries:u}}const Ce=e=>(...n)=>{if(ue(e))return Ce(e(...n))();if(Ke(e))return e;if(qe(e)){const{url:t,...r}=e;return pe(t,r)}else{if(De(e))return pe(e);throw Be("Unknown service type",!0)}};function Je(e,n){const t=Ce(e),{reset:r,run:s,...E}=Ge(t,n??{}),f=l(!1);return{reload:async()=>{const{defaultParams:v=[],manual:T}=n;r(),T||(f.value=!0,await s(...v),f.value=!1)},run:s,reloading:f,...E}}export{Je as u};
